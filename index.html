<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimaID v2 - –°–∫–µ–ª–µ—Ç–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –Ω–∞ 120 BPM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
        }
        
        button {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .main-view {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .dancer-showcase {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            position: relative;
        }
        
        .bpm-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.1);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            color: #667eea;
        }
        
        .beat-flash {
            animation: beatPulse 0.5s ease-out;
        }
        
        @keyframes beatPulse {
            0% { background: rgba(102, 126, 234, 0.3); }
            100% { background: rgba(102, 126, 234, 0.1); }
        }
        
        .info-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }
        
        .info-section {
            margin-bottom: 20px;
        }
        
        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .param-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .param-item:last-child {
            border-bottom: none;
        }
        
        .param-label {
            color: #666;
        }
        
        .param-value {
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-weight: bold;
        }
        
        .dance-moves-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .move-item {
            padding: 8px;
            margin-bottom: 5px;
            background: #f0f4ff;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .gallery-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .gallery-avatar {
            width: 100px;
            height: 100px;
            margin: 0 auto 10px;
        }
        
        .gallery-label {
            font-size: 0.85em;
            color: #666;
            word-break: break-all;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-view {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üï∫ AnimaID v2.0</h1>
        <p class="subtitle">–ü—Ä–æ—Ü–µ–¥—É—Ä–Ω–∞—è —Å–∫–µ–ª–µ—Ç–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –Ω–∞ 120 BPM</p>
        
        <div class="controls">
            <div class="input-group">
                <input 
                    type="text" 
                    id="ulidInput" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ ULID (26 —Å–∏–º–≤–æ–ª–æ–≤)"
                    value="01HQZM3K7X9YF2NW8TBVKJD6PQ"
                    maxlength="26"
                >
                <button onclick="generateDancer()">üé® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                <button onclick="randomULID()">üé≤ –°–ª—É—á–∞–π–Ω—ã–π</button>
                <button onclick="generateGallery()">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è (10 —à—Ç—É–∫)</button>
            </div>
        </div>
        
        <div class="main-view">
            <div class="dancer-showcase">
                <div class="bpm-indicator" id="bpmIndicator">‚ô™ 120 BPM</div>
                <div id="mainDancer"></div>
            </div>
            
            <div class="info-panel">
                <div class="info-section">
                    <h3>üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                    <div id="params"></div>
                </div>
                
                <div class="info-section">
                    <h3>üíÉ –¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                    <div class="dance-moves-list" id="movesList"></div>
                </div>
            </div>
        </div>
        
        <div class="gallery" id="gallery"></div>
        
        <div class="info-box">
            <h3>üéµ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∫–µ–ª–µ—Ç–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è:</h3>
            <p><strong>1. –°–∫–µ–ª–µ—Ç:</strong> –ì–æ–ª–æ–≤–∞, —à–µ—è, —Ç–æ—Ä—Å, –ø–ª–µ—á–∏, –ª–æ–∫—Ç–∏, –∫–∏—Å—Ç–∏, –±—ë–¥—Ä–∞, –∫–æ–ª–µ–Ω–∏, —Å—Ç–æ–ø—ã (15 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)</p>
            <p><strong>2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–∑:</strong> –ò–∑ ULID —Å–æ–∑–¥–∞—é—Ç—Å—è 16 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑ (–∫–ª—é—á–µ–≤—ã—Ö –∫–∞–¥—Ä–æ–≤)</p>
            <p><strong>3. –§–∏–∑–∏–∫–∞:</strong> 
                ‚Ä¢ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä—É–∫/–Ω–æ–≥ (–ø—Ä–∞–≤–∞—è –Ω–æ–≥–∞ –≤–ø–µ—Ä—ë–¥ ‚Üí –ª–µ–≤–∞—è —Ä—É–∫–∞ –≤–ø–µ—Ä—ë–¥)<br>
                ‚Ä¢ –ë–∞–ª–∞–Ω—Å —Ç–µ–ª–∞ (–Ω–∞–∫–ª–æ–Ω —Ç–æ—Ä—Å–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞ –º–∞—Å—Å)<br>
                ‚Ä¢ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–≥–∏–±–∞–Ω–∏–µ –∫–æ–ª–µ–Ω–µ–π –ø—Ä–∏ —Ö–æ–¥—å–±–µ<br>
                ‚Ä¢ –£–≥–ª—ã —Å—É—Å—Ç–∞–≤–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –∞–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏
            </p>
            <p><strong>4. –¢–µ–º–ø:</strong> 120 BPM = 0.5 —Å–µ–∫/–±–∏—Ç, 8 –±–∏—Ç –Ω–∞ —Ü–∏–∫–ª = 4 —Å–µ–∫—É–Ω–¥—ã –ø–æ–ª–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>
            <p><strong>5. –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:</strong> –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –ø–æ–∑–∞–º–∏ —á–µ—Ä–µ–∑ ease-in-out (–∏–Ω–µ—Ä—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è)</p>
            <p><strong>6. –î–µ—Ç–∞–ª–∏:</strong> –ö–∏—Å—Ç–∏ —Ä—É–∫ –∏ —Å—Ç–æ–ø—ã –¥–ª—è –±–æ–ª—å—à–µ–π –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>
        </div>
    </div>
    
    <script>
        class SkeletalAnimaID {
            constructor(ulid) {
                this.ulid = ulid;
                this.seed = this.hashULID(ulid);
                this.bpm = 120;
                this.beatsPerCycle = 8;
                this.cycleDuration = (60 / this.bpm) * this.beatsPerCycle; // 4 —Å–µ–∫—É–Ω–¥—ã
            }
            
            hashULID(ulid) {
                let hash = 0;
                for (let i = 0; i < ulid.length; i++) {
                    const char = ulid.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }
            
            seededRandom(seed) {
                const x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ü–≤–µ—Ç–∞
            generateColor() {
                const r1 = this.seededRandom(this.seed * 3);
                const r2 = this.seededRandom(this.seed * 4);
                const r3 = this.seededRandom(this.seed * 5);
                
                return {
                    hue: Math.floor(r1 * 360),
                    saturation: 60 + Math.floor(r2 * 40),
                    lightness: 40 + Math.floor(r3 * 20)
                };
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —ç–Ω–µ—Ä–≥–∏—é —Ç–∞–Ω—Ü–∞ (–Ω–∞—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–π)
            generateEnergy() {
                return 0.3 + this.seededRandom(this.seed * 6) * 0.7; // 0.3 –¥–æ 1.0
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            generatePhysique() {
                const r1 = this.seededRandom(this.seed * 132);
                
                return {
                    // –†–æ—Å—Ç: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö
                    height: 1.0,
                    // –¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ: –æ—Ç 0.85 (—Å—Ç—Ä–æ–π–Ω—ã–π) –¥–æ 1.25 (–ø–ª–æ—Ç–Ω—ã–π) - –Ω–µ —Å–ª–∏—à–∫–æ–º —Ö—É–¥—ã–µ
                    build: 0.85 + r1 * 0.4,
                    // –ü—Ä–æ–ø–æ—Ä—Ü–∏–∏: —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –Ω–æ–≥ –∫ —Ç–æ—Ä—Å—É
                    legToBodyRatio: 1.0  // –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
                };
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π (—Å—Ç–∏–ª—å —Ç–∞–Ω—Ü–∞)
            generateMovePreferences() {
                const r = (offset) => this.seededRandom(this.seed * offset);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π —Å—Ç–∏–ª—å —Ç–∞–Ω—Ü–∞
                const styleRoll = r(7);
                let style = {};
                
                if (styleRoll < 0.15) {
                    // –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π, –∞–∫—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å (—Ö–∏–ø-—Ö–æ–ø, –±—Ä–µ–π–∫)
                    style = {
                        armMovement: 0.8 + r(71) * 0.2,
                        legMovement: 0.7 + r(72) * 0.3,
                        bodyRotation: 0.6 + r(73) * 0.4,
                        jumpiness: 0.5 + r(74) * 0.5,
                        symmetry: r(75) * 0.4,
                        headMovement: 0.5 + r(76) * 0.5,
                        hipSway: r(77) * 0.3,
                        shoulderBounce: 0.6 + r(78) * 0.4,
                        rhythmVariation: 0.6 + r(79) * 0.4
                    };
                } else if (styleRoll < 0.30) {
                    // –ü–ª–∞–≤–Ω—ã–π, –≤–æ–ª–Ω–æ–≤–æ–π —Å—Ç–∏–ª—å (–∫–æ–Ω—Ç–µ–º–ø–æ—Ä–∞—Ä–∏, –ª–∏—Ä–∏—á–µ—Å–∫–∏–π)
                    style = {
                        armMovement: 0.7 + r(81) * 0.3,
                        legMovement: 0.4 + r(82) * 0.3,
                        bodyRotation: 0.5 + r(83) * 0.3,
                        jumpiness: 0.1 + r(84) * 0.3,
                        symmetry: 0.6 + r(85) * 0.4,
                        headMovement: 0.3 + r(86) * 0.4,
                        hipSway: 0.5 + r(87) * 0.5,
                        shoulderBounce: 0.2 + r(88) * 0.3,
                        rhythmVariation: 0.2 + r(89) * 0.3
                    };
                } else if (styleRoll < 0.45) {
                    // –†–∏—Ç–º–∏—á–Ω—ã–π, —É–¥–∞—Ä–Ω—ã–π —Å—Ç–∏–ª—å (—Å—Ç–µ–ø, –∞—Ñ—Ä–∏–∫–∞–Ω—Å–∫–∏–π)
                    style = {
                        armMovement: 0.4 + r(91) * 0.4,
                        legMovement: 0.8 + r(92) * 0.2,
                        bodyRotation: 0.3 + r(93) * 0.4,
                        jumpiness: 0.4 + r(94) * 0.5,
                        symmetry: 0.7 + r(95) * 0.3,
                        headMovement: 0.6 + r(96) * 0.4,
                        hipSway: 0.3 + r(97) * 0.3,
                        shoulderBounce: 0.5 + r(98) * 0.5,
                        rhythmVariation: 0.7 + r(99) * 0.3
                    };
                } else if (styleRoll < 0.60) {
                    // –õ–∞—Ç–∏–Ω–æ–∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å (—Å–∞–ª—å—Å–∞, —Å–∞–º–±–∞)
                    style = {
                        armMovement: 0.6 + r(101) * 0.4,
                        legMovement: 0.6 + r(102) * 0.4,
                        bodyRotation: 0.7 + r(103) * 0.3,
                        jumpiness: 0.2 + r(104) * 0.3,
                        symmetry: r(105) * 0.5,
                        headMovement: 0.4 + r(106) * 0.3,
                        hipSway: 0.8 + r(107) * 0.2,
                        shoulderBounce: 0.4 + r(108) * 0.4,
                        rhythmVariation: 0.5 + r(109) * 0.3
                    };
                } else if (styleRoll < 0.75) {
                    // –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π (–±–∞–ª–µ—Ç, –¥–∂–∞–∑)
                    style = {
                        armMovement: 0.7 + r(111) * 0.3,
                        legMovement: 0.6 + r(112) * 0.4,
                        bodyRotation: 0.4 + r(113) * 0.3,
                        jumpiness: 0.3 + r(114) * 0.4,
                        symmetry: 0.8 + r(115) * 0.2,
                        headMovement: 0.2 + r(116) * 0.3,
                        hipSway: 0.2 + r(117) * 0.3,
                        shoulderBounce: 0.3 + r(118) * 0.3,
                        rhythmVariation: 0.3 + r(119) * 0.2
                    };
                } else {
                    // –°–ª—É—á–∞–π–Ω—ã–π, freestyle
                    style = {
                        armMovement: r(121),
                        legMovement: r(122),
                        bodyRotation: r(123),
                        jumpiness: r(124),
                        symmetry: r(125),
                        headMovement: r(126),
                        hipSway: r(127),
                        shoulderBounce: r(128),
                        rhythmVariation: r(129)
                    };
                }
                
                return style;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑ 16 –ø–æ–∑ (16 –∫–∞–¥—Ä–æ–≤ = 8 –±–∏—Ç–æ–≤)
            generatePoseSequence() {
                const energy = this.generateEnergy();
                const prefs = this.generateMovePreferences();
                const poses = [];
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 15 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–∑
                for (let i = 0; i < 15; i++) {
                    const t = i / 15; // 0 to 1
                    const seed = this.seed + i * 1000;
                    
                    poses.push(this.generatePose(t, energy, prefs, seed));
                }
                
                // 16-—è –ø–æ–∑–∞ = –ø–µ—Ä–≤–∞—è –ø–æ–∑–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è
                poses.push(poses[0]);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ù–ï–ó–ê–í–ò–°–ò–ú–£–Æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≥–æ–ª–æ–≤—ã
                this.generateHeadSequence(poses, energy, prefs);
                
                return poses;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –∞–Ω–∏–º–∞—Ü–∏—é –≥–æ–ª–æ–≤—ã (–∫–∞—á–∞–µ—Ç—Å—è –≤ —Å–≤–æ—ë–º —Ä–∏—Ç–º–µ)
            generateHeadSequence(poses, energy, prefs) {
                const headSeed = this.seed * 7 + 12345; // –¥—Ä—É–≥–æ–π seed –¥–ª—è –≥–æ–ª–æ–≤—ã
                const r = (i, offset) => this.seededRandom(headSeed + i * 500 + offset);
                
                for (let i = 0; i < poses.length - 1; i++) {
                    const t = i / 14;
                    
                    // –ò–Ω–¥–∏–π—Å–∫–æ–µ –∫–∞—á–∞–Ω–∏–µ: –Ω–µ–±–æ–ª—å—à–æ–µ —Å–º–µ—â–µ–Ω–∏–µ + –Ω–∞–∫–ª–æ–Ω, —É—Å–∏–ª–µ–Ω–Ω–æ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º headMovement
                    const baseSwing = Math.sin(t * Math.PI * 4) * 8 * prefs.headMovement; // –±–æ–ª—å—à–µ –¥–≤–∏–∂–µ–Ω–∏—è –≥–æ–ª–æ–≤–æ–π
                    const randomOffset = this.lerp(-3, 3, r(i, 0)) * energy * prefs.headMovement;
                    
                    poses[i].headTilt = baseSwing + randomOffset;
                }
                
                // –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–∞–¥—Ä = –ø–µ—Ä–≤—ã–π
                poses[poses.length - 1].headTilt = poses[0].headTilt;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–¥–Ω—É –ø–æ–∑—É
            generatePose(t, energy, prefs, seed) {
                const r = (offset) => this.seededRandom(seed + offset);
                
                // –ü–æ–≤–æ—Ä–æ—Ç –∫–æ—Ä–ø—É—Å–∞ —Å —É—á—ë—Ç–æ–º –∫–∞—á–∞–Ω–∏—è –±—ë–¥—Ä–∞–º–∏
                const bodyRotate = this.lerp(-20, 20, r(2)) * energy * prefs.bodyRotation;
                const hipSway = Math.sin(t * Math.PI * 4) * 15 * energy * prefs.hipSway; // –±—ã—Å—Ç—Ä–æ–µ –∫–∞—á–∞–Ω–∏–µ –±—ë–¥—Ä–∞–º–∏
                
                // –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–ø–æ—Ä–Ω—É—é –Ω–æ–≥—É (–∫–æ—Ç–æ—Ä–∞—è –∫–∞—Å–∞–µ—Ç—Å—è –∑–µ–º–ª–∏)
                const isRightLegSupporting = Math.cos(t * Math.PI * 2) > 0;
                
                // –ü—Ä–∞–≤–∞—è –Ω–æ–≥–∞
                let rightHipAngle, rightKneeAngle, rightHipOffsetX;
                if (isRightLegSupporting) {
                    // –û–ø–æ—Ä–Ω–∞—è –Ω–æ–≥–∞ - –±–æ–ª–µ–µ –ø—Ä—è–º–∞—è, –Ω–æ –¥–≤–∏–≥–∞–µ—Ç—Å—è –≤ —Å—Ç–æ—Ä–æ–Ω—ã
                    rightHipAngle = this.lerp(-20, 20, r(7)) * energy * prefs.legMovement * 0.7;
                    rightKneeAngle = this.lerp(0, 30, r(8)) * prefs.legMovement * 0.5;
                    rightHipOffsetX = this.lerp(-8, 8, r(71)) * energy; // –±–æ–∫–æ–≤–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
                } else {
                    // –ù–µ–æ–ø–æ—Ä–Ω–∞—è –Ω–æ–≥–∞ - –º–æ–∂–µ—Ç –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è, —Å–≥–∏–±–∞—Ç—å—Å—è –±–æ–ª—å—à–µ
                    rightHipAngle = this.lerp(-60, 60, r(7)) * energy * prefs.legMovement;
                    rightKneeAngle = rightHipAngle < 0 
                        ? this.lerp(50, 110, r(8)) * prefs.legMovement
                        : this.lerp(15, 60, r(8)) * prefs.legMovement;
                    rightHipOffsetX = this.lerp(-12, 12, r(72)) * energy; // –±–æ–ª—å—à–µ –±–æ–∫–æ–≤–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è
                }
                
                // –õ–µ–≤–∞—è –Ω–æ–≥–∞
                let leftHipAngle, leftKneeAngle, leftHipOffsetX;
                if (!isRightLegSupporting) {
                    // –û–ø–æ—Ä–Ω–∞—è –Ω–æ–≥–∞
                    leftHipAngle = prefs.symmetry > 0.6
                        ? -rightHipAngle
                        : this.lerp(-20, 20, r(9)) * energy * prefs.legMovement * 0.7;
                    leftKneeAngle = this.lerp(0, 30, r(10)) * prefs.legMovement * 0.5;
                    leftHipOffsetX = prefs.symmetry > 0.6
                        ? -rightHipOffsetX
                        : this.lerp(-8, 8, r(73)) * energy;
                } else {
                    // –ù–µ–æ–ø–æ—Ä–Ω–∞—è –Ω–æ–≥–∞
                    leftHipAngle = prefs.symmetry > 0.6
                        ? -rightHipAngle
                        : this.lerp(-60, 60, r(9)) * energy * prefs.legMovement;
                    leftKneeAngle = prefs.symmetry > 0.6
                        ? (rightHipAngle > 0 
                            ? this.lerp(50, 110, r(8)) * prefs.legMovement 
                            : this.lerp(15, 60, r(8)) * prefs.legMovement)
                        : this.lerp(15, 110, r(10)) * prefs.legMovement;
                    leftHipOffsetX = prefs.symmetry > 0.6
                        ? -rightHipOffsetX
                        : this.lerp(-12, 12, r(74)) * energy;
                }
                
                // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä—É–∫ —Å –Ω–æ–≥–∞–º–∏
                const leftArmCompensation = rightHipAngle * -0.5;
                const rightArmCompensation = rightHipAngle * 0.5;
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–µ—á (–ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ)
                const shoulderBounce = Math.sin(t * Math.PI * 8) * 15 * energy * prefs.shoulderBounce;
                
                // –ë–∞–ª–∞–Ω—Å —Ç–µ–ª–∞
                const balanceTilt = -rightHipAngle * 0.3;
                
                // –ë–∞–∑–æ–≤–∞—è –ø–æ–∑–∞ —Å –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏
                const pose = {
                    // –¢–æ—Ä—Å (–Ω–∞–∫–ª–æ–Ω –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ + –ø–æ–≤–æ—Ä–æ—Ç + –∫–∞—á–∞–Ω–∏–µ –±—ë–¥—Ä–∞–º–∏)
                    bodyTilt: balanceTilt + this.lerp(-10, 10, r(1)) * energy * prefs.bodyRotation + hipSway * 0.3,
                    bodyRotate: bodyRotate + hipSway * 0.5,
                    
                    // –ü—Ä–∞–≤–∞—è —Ä—É–∫–∞ (—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–µ–π, –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ–º –ø–ª–µ—á –∏ –±–æ–ª—å—à–µ–π –∞–º–ø–ª–∏—Ç—É–¥–æ–π)
                    rightShoulderAngle: 45 + rightArmCompensation + shoulderBounce * 0.5 + 
                        this.lerp(-80, 80, r(3)) * energy * prefs.armMovement,
                    rightElbowAngle: this.lerp(-30, 150, r(4)) * (0.3 + 0.7 * prefs.armMovement),
                    
                    // –õ–µ–≤–∞—è —Ä—É–∫–∞
                    leftShoulderAngle: prefs.symmetry > 0.7 
                        ? -(45 + rightArmCompensation + shoulderBounce * 0.5 + 
                            this.lerp(-80, 80, r(3)) * energy * prefs.armMovement)
                        : -45 + leftArmCompensation - shoulderBounce * 0.5 + 
                            this.lerp(-80, 80, r(5)) * energy * prefs.armMovement,
                    leftElbowAngle: prefs.symmetry > 0.7
                        ? this.lerp(-30, 150, r(4)) * (0.3 + 0.7 * prefs.armMovement)
                        : this.lerp(-30, 150, r(6)) * (0.3 + 0.7 * prefs.armMovement),
                    
                    // –ù–æ–≥–∏ (—Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –æ–ø–æ—Ä—ã –∏ –±–æ–∫–æ–≤—ã–º —Å–º–µ—â–µ–Ω–∏–µ–º)
                    rightHipAngle: rightHipAngle,
                    rightKneeAngle: rightKneeAngle,
                    rightHipOffsetX: rightHipOffsetX,
                    leftHipAngle: leftHipAngle,
                    leftKneeAngle: leftKneeAngle,
                    leftHipOffsetX: leftHipOffsetX,
                    
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (–ø—Ä—ã–∂–∫–∏)
                    verticalOffset: Math.sin(t * Math.PI * 2) * 15 * energy * prefs.jumpiness,
                    
                    // –ì–æ–ª–æ–≤–∞ - –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
                    headTilt: 0
                };
                
                return pose;
            }
            
            lerp(min, max, t) {
                return min + (max - min) * t;
            }
            
            // –û–ø–∏—Å—ã–≤–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º
            describePose(pose, index) {
                const descriptions = [];
                
                if (Math.abs(pose.rightShoulderAngle - 45) > 50) {
                    descriptions.push(pose.rightShoulderAngle > 45 ? "–ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ –≤–≤–µ—Ä—Ö" : "–ø—Ä–∞–≤–∞—è —Ä—É–∫–∞ –≤–Ω–∏–∑");
                }
                if (Math.abs(pose.leftShoulderAngle + 45) > 50) {
                    descriptions.push(pose.leftShoulderAngle > -45 ? "–ª–µ–≤–∞—è —Ä—É–∫–∞ –≤–Ω–∏–∑" : "–ª–µ–≤–∞—è —Ä—É–∫–∞ –≤–≤–µ—Ä—Ö");
                }
                if (Math.abs(pose.rightHipAngle) > 20) {
                    descriptions.push(pose.rightHipAngle > 0 ? "–ø—Ä–∞–≤–∞—è –Ω–æ–≥–∞ –≤–ø–µ—Ä—ë–¥" : "–ø—Ä–∞–≤–∞—è –Ω–æ–≥–∞ –Ω–∞–∑–∞–¥");
                }
                if (Math.abs(pose.leftHipAngle) > 20) {
                    descriptions.push(pose.leftHipAngle > 0 ? "–ª–µ–≤–∞—è –Ω–æ–≥–∞ –≤–ø–µ—Ä—ë–¥" : "–ª–µ–≤–∞—è –Ω–æ–≥–∞ –Ω–∞–∑–∞–¥");
                }
                if (Math.abs(pose.verticalOffset) > 8) {
                    descriptions.push(pose.verticalOffset < 0 ? "–ø—Ä—ã–∂–æ–∫" : "–ø—Ä–∏—Å–µ–¥");
                }
                if (Math.abs(pose.bodyRotate) > 12) {
                    descriptions.push(pose.bodyRotate > 0 ? "–ø–æ–≤–æ—Ä–æ—Ç –≤–ø—Ä–∞–≤–æ" : "–ø–æ–≤–æ—Ä–æ—Ç –≤–ª–µ–≤–æ");
                }
                if (Math.abs(pose.bodyTilt) > 8) {
                    descriptions.push("–±–∞–ª–∞–Ω—Å");
                }
                
                return descriptions.length > 0 
                    ? `–¢–∞–∫—Ç ${index + 1}: ${descriptions.join(", ")}` 
                    : `–¢–∞–∫—Ç ${index + 1}: –±–∞–∑–æ–≤–∞—è —Å—Ç–æ–π–∫–∞`;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º CSS keyframes
            generateKeyframes(poses) {
                let keyframes = '';
                
                for (let i = 0; i < poses.length; i++) {
                    const percent = (i / poses.length) * 100;
                    const pose = poses[i];
                    
                    keyframes += `
                        ${percent.toFixed(2)}% {
                            transform: translateY(${pose.verticalOffset}px);
                        }
                    `;
                }
                
                return keyframes;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º SVG —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            generateSVG(size = 200) {
                const color = this.generateColor();
                const colorStr = `hsl(${color.hue}, ${color.saturation}%, ${color.lightness}%)`;
                const poses = this.generatePoseSequence();
                const physique = this.generatePhysique();
                const id = `dancer-${this.ulid}`;
                
                // –ë–∞–∑–æ–≤—ã–µ –∞–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏–µ –¥–ª–∏–Ω—ã, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ —Ä–æ—Å—Ç—É –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º
                const heightScale = physique.height;
                const legScale = physique.legToBodyRatio;
                
                // –î–ª–∏–Ω—ã —á–∞—Å—Ç–µ–π —Ç–µ–ª–∞
                const headRadius = 18 * heightScale;
                const upperArmLength = 35 * heightScale;
                const lowerArmLength = 30 * heightScale;
                const upperLegLength = 40 * heightScale * legScale;
                const lowerLegLength = 45 * heightScale * legScale;
                const torsoLength = 82 * heightScale; // –æ—Ç –≥–æ–ª–æ–≤—ã –¥–æ –±—ë–¥–µ—Ä
                
                // –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏—è
                const buildScale = physique.build;
                const torsoWidth = 5 * buildScale;
                const armWidth = 4 * buildScale;
                const legWidth = 5 * buildScale;
                
                // –¶–µ–Ω—Ç—Ä —Ñ–∏–≥—É—Ä—ã (–±—ë–¥—Ä–∞)
                const hipY = 50 + torsoLength;
                
                // –°–æ–∑–¥–∞—ë–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
                const animations = this.generateAllAnimations(poses, id);
                
                return `
                    <svg viewBox="0 0 200 ${Math.max(300, hipY + upperLegLength + lowerLegLength + 30)}" 
                         width="${size}" height="${size * 1.5}" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <style>
                                .${id}-container {
                                    animation: ${id}-body ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-head {
                                    animation: ${id}-head ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-right-arm {
                                    animation: ${id}-right-shoulder ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-right-forearm {
                                    animation: ${id}-right-elbow ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-left-arm {
                                    animation: ${id}-left-shoulder ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-left-forearm {
                                    animation: ${id}-left-elbow ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-right-leg {
                                    animation: ${id}-right-hip ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-right-shin {
                                    animation: ${id}-right-knee ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-left-leg {
                                    animation: ${id}-left-hip ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-left-shin {
                                    animation: ${id}-left-knee ${this.cycleDuration}s ease-in-out infinite;
                                }
                                .${id}-shadow {
                                    animation: ${id}-shadow ${this.cycleDuration}s ease-in-out infinite;
                                    transform-origin: center center;
                                }
                                ${animations}
                            </style>
                        </defs>
                        
                        <!-- –¢–µ–Ω—å –ø–æ–¥ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º (–±–æ–ª–µ–µ —Ç—ë–º–Ω–∞—è –∏ –∑–∞–º–µ—Ç–Ω–∞—è) -->
                        <ellipse cx="100" cy="${hipY + upperLegLength + lowerLegLength + 10}" 
                                 rx="${25 * buildScale}" ry="6" fill="rgba(0,0,0,0.3)" class="${id}-shadow"/>
                        
                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ–π —Ñ–∏–≥—É—Ä—ã (–¥–ª—è –ø—Ä—ã–∂–∫–æ–≤ –∏ –ø–æ–≤–æ—Ä–æ—Ç–∞ –∫–æ—Ä–ø—É—Å–∞) -->
                        <g class="${id}-container" transform-origin="100 ${hipY}">
                            
                            <!-- –ì–æ–ª–æ–≤–∞ —Å —à–µ–µ–π –∏ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç—å—é —Ç–æ—Ä—Å–∞ (–∫–∞—á–∞–µ—Ç—Å—è –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ) -->
                            <g class="${id}-head" transform-origin="100 50">
                                <!-- –®–µ—è –∏ –≤–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å —Ç–æ—Ä—Å–∞ –¥–æ –ø–ª–µ—á (—Å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ–º) -->
                                <line x1="100" y1="${50 + headRadius}" x2="100" y2="${50 + headRadius + 20 * heightScale}" 
                                      stroke="${colorStr}" stroke-width="${torsoWidth}" stroke-linecap="round"/>
                                <!-- –ì–æ–ª–æ–≤–∞ (–±–µ–∑ –ª–∏—Ü–∞) -->
                                <circle cx="100" cy="50" r="${headRadius}" fill="${colorStr}"/>
                            </g>
                            
                            <!-- –°—Ä–µ–¥–Ω—è—è –∏ –Ω–∏–∂–Ω—è—è —á–∞—Å—Ç—å —Ç–æ—Ä—Å–∞ (–æ—Ç —á—É—Ç—å –≤—ã—à–µ –ø–ª–µ—á –¥–æ –±—ë–¥–µ—Ä) -->
                            <line x1="100" y1="${50 + headRadius + 14 * heightScale}" x2="100" y2="${hipY}" 
                                  stroke="${colorStr}" stroke-width="${torsoWidth}" stroke-linecap="round"/>
                            
                            <!-- –ü–æ–∑–∏—Ü–∏—è –ø–ª–µ—á (–æ—Ç–∫—É–¥–∞ —Ä–∞—Å—Ç—É—Ç —Ä—É–∫–∏) -->
                            ${(() => {
                                const shoulderY = 50 + headRadius + 17 * heightScale;
                                return `
                            <!-- –ü–†–ê–í–ê–Ø –†–£–ö–ê -->
                            <g class="${id}-right-arm" transform-origin="100 ${shoulderY}">
                                <!-- –ü–ª–µ—á–æ -->
                                <line x1="100" y1="${shoulderY}" x2="100" y2="${shoulderY + upperArmLength}" 
                                      stroke="${colorStr}" stroke-width="${armWidth}" stroke-linecap="round"/>
                                <circle cx="100" cy="${shoulderY}" r="${armWidth}" fill="${colorStr}"/>
                                
                                <!-- –ü—Ä–µ–¥–ø–ª–µ—á—å–µ (–≤–ª–æ–∂–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞, –≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç –ª–æ–∫—Ç—è) -->
                                <g class="${id}-right-forearm" transform-origin="100 ${shoulderY + upperArmLength}">
                                    <circle cx="100" cy="${shoulderY + upperArmLength}" r="${armWidth * 0.9}" fill="${colorStr}"/>
                                    <line x1="100" y1="${shoulderY + upperArmLength}" 
                                          x2="100" y2="${shoulderY + upperArmLength + lowerArmLength}" 
                                          stroke="${colorStr}" stroke-width="${armWidth * 0.9}" stroke-linecap="round"/>
                                    <!-- –ö–∏—Å—Ç—å —Ä—É–∫–∏ -->
                                    <circle cx="100" cy="${shoulderY + upperArmLength + lowerArmLength}" r="${armWidth * 0.75}" fill="${colorStr}"/>
                                </g>
                            </g>
                            
                            <!-- –õ–ï–í–ê–Ø –†–£–ö–ê -->
                            <g class="${id}-left-arm" transform-origin="100 ${shoulderY}">
                                <!-- –ü–ª–µ—á–æ -->
                                <line x1="100" y1="${shoulderY}" x2="100" y2="${shoulderY + upperArmLength}" 
                                      stroke="${colorStr}" stroke-width="${armWidth}" stroke-linecap="round"/>
                                <circle cx="100" cy="${shoulderY}" r="${armWidth}" fill="${colorStr}"/>
                                
                                <!-- –ü—Ä–µ–¥–ø–ª–µ—á—å–µ -->
                                <g class="${id}-left-forearm" transform-origin="100 ${shoulderY + upperArmLength}">
                                    <circle cx="100" cy="${shoulderY + upperArmLength}" r="${armWidth * 0.9}" fill="${colorStr}"/>
                                    <line x1="100" y1="${shoulderY + upperArmLength}" 
                                          x2="100" y2="${shoulderY + upperArmLength + lowerArmLength}" 
                                          stroke="${colorStr}" stroke-width="${armWidth * 0.9}" stroke-linecap="round"/>
                                    <!-- –ö–∏—Å—Ç—å —Ä—É–∫–∏ -->
                                    <circle cx="100" cy="${shoulderY + upperArmLength + lowerArmLength}" r="${armWidth * 0.75}" fill="${colorStr}"/>
                                </g>
                            </g>
                                `;
                            })()}
                            
                            <!-- –ü–†–ê–í–ê–Ø –ù–û–ì–ê -->
                            <g class="${id}-right-leg" transform-origin="100 ${hipY}">
                                <!-- –ë–µ–¥—Ä–æ -->
                                <line x1="100" y1="${hipY}" x2="100" y2="${hipY + upperLegLength}" 
                                      stroke="${colorStr}" stroke-width="${legWidth}" stroke-linecap="round"/>
                                <circle cx="100" cy="${hipY}" r="${legWidth}" fill="${colorStr}"/>
                                
                                <!-- –ì–æ–ª–µ–Ω—å -->
                                <g class="${id}-right-shin" transform-origin="100 ${hipY + upperLegLength}">
                                    <circle cx="100" cy="${hipY + upperLegLength}" r="${legWidth * 0.9}" fill="${colorStr}"/>
                                    <line x1="100" y1="${hipY + upperLegLength}" 
                                          x2="100" y2="${hipY + upperLegLength + lowerLegLength}" 
                                          stroke="${colorStr}" stroke-width="${legWidth * 0.9}" stroke-linecap="round"/>
                                    <!-- –°—Ç–æ–ø–∞ -->
                                    <ellipse cx="102" cy="${hipY + upperLegLength + lowerLegLength + 2}" 
                                             rx="${8 * buildScale}" ry="${4 * buildScale}" fill="${colorStr}"/>
                                </g>
                            </g>
                            
                            <!-- –õ–ï–í–ê–Ø –ù–û–ì–ê -->
                            <g class="${id}-left-leg" transform-origin="100 ${hipY}">
                                <!-- –ë–µ–¥—Ä–æ -->
                                <line x1="100" y1="${hipY}" x2="100" y2="${hipY + upperLegLength}" 
                                      stroke="${colorStr}" stroke-width="${legWidth}" stroke-linecap="round"/>
                                <circle cx="100" cy="${hipY}" r="${legWidth}" fill="${colorStr}"/>
                                
                                <!-- –ì–æ–ª–µ–Ω—å -->
                                <g class="${id}-left-shin" transform-origin="100 ${hipY + upperLegLength}">
                                    <circle cx="100" cy="${hipY + upperLegLength}" r="${legWidth * 0.9}" fill="${colorStr}"/>
                                    <line x1="100" y1="${hipY + upperLegLength}" 
                                          x2="100" y2="${hipY + upperLegLength + lowerLegLength}" 
                                          stroke="${colorStr}" stroke-width="${legWidth * 0.9}" stroke-linecap="round"/>
                                    <!-- –°—Ç–æ–ø–∞ -->
                                    <ellipse cx="102" cy="${hipY + upperLegLength + lowerLegLength + 2}" 
                                             rx="${8 * buildScale}" ry="${4 * buildScale}" fill="${colorStr}"/>
                                </g>
                            </g>
                        </g>
                    </svg>
                `;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ CSS –∞–Ω–∏–º–∞—Ü–∏–∏
            generateAllAnimations(poses, id) {
                let css = '';
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–ª–∞ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ + –ø–æ–≤–æ—Ä–æ—Ç –∫–æ—Ä–ø—É—Å–∞)
                css += `@keyframes ${id}-body {\n`;
                css += `    0% { transform: translateY(${poses[0].verticalOffset}px) rotate(${poses[0].bodyRotate}deg); }\n`;
                for (let i = 1; i < poses.length - 1; i++) {
                    const percent = (i / (poses.length - 1)) * 100;
                    const pose = poses[i];
                    css += `    ${percent.toFixed(2)}% { transform: translateY(${pose.verticalOffset}px) rotate(${pose.bodyRotate}deg); }\n`;
                }
                css += `    100% { transform: translateY(${poses[0].verticalOffset}px) rotate(${poses[0].bodyRotate}deg); }\n`;
                css += `}\n\n`;
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –≥–æ–ª–æ–≤—ã (–∏–Ω–¥–∏–π—Å–∫–æ–µ –∫–∞—á–∞–Ω–∏–µ –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ)
                css += `@keyframes ${id}-head {\n`;
                css += `    0% { transform: translateX(${poses[0].headTilt}px) rotate(${poses[0].headTilt * 2}deg); }\n`;
                for (let i = 1; i < poses.length - 1; i++) {
                    const percent = (i / (poses.length - 1)) * 100;
                    const pose = poses[i];
                    // translateX –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –≤–ª–µ–≤–æ-–≤–ø—Ä–∞–≤–æ (–º–∞–ª–æ–µ) + rotate –¥–ª—è –Ω–∞–∫–ª–æ–Ω–∞ (–±–æ–ª—å—à–æ–π)
                    css += `    ${percent.toFixed(2)}% { transform: translateX(${pose.headTilt}px) rotate(${pose.headTilt * 2}deg); }\n`;
                }
                css += `    100% { transform: translateX(${poses[0].headTilt}px) rotate(${poses[0].headTilt * 2}deg); }\n`;
                css += `}\n\n`;
                
                // –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–µ–π
                const limbs = [
                    { name: 'right-shoulder', angle: 'rightShoulderAngle', type: 'rotate' },
                    { name: 'right-elbow', angle: 'rightElbowAngle', type: 'rotate' },
                    { name: 'left-shoulder', angle: 'leftShoulderAngle', type: 'rotate' },
                    { name: 'left-elbow', angle: 'leftElbowAngle', type: 'rotate' },
                    { name: 'right-hip', angle: 'rightHipAngle', offset: 'rightHipOffsetX', type: 'both' },
                    { name: 'right-knee', angle: 'rightKneeAngle', type: 'rotate' },
                    { name: 'left-hip', angle: 'leftHipAngle', offset: 'leftHipOffsetX', type: 'both' },
                    { name: 'left-knee', angle: 'leftKneeAngle', type: 'rotate' }
                ];
                
                limbs.forEach(limb => {
                    css += `@keyframes ${id}-${limb.name} {\n`;
                    if (limb.type === 'both') {
                        // –î–ª—è –±—ë–¥–µ—Ä: –∏ –≤—Ä–∞—â–µ–Ω–∏–µ –∏ –±–æ–∫–æ–≤–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
                        css += `    0% { transform: translateX(${poses[0][limb.offset]}px) rotate(${poses[0][limb.angle]}deg); }\n`;
                        for (let i = 1; i < poses.length - 1; i++) {
                            const percent = (i / (poses.length - 1)) * 100;
                            const pose = poses[i];
                            css += `    ${percent.toFixed(2)}% { transform: translateX(${pose[limb.offset]}px) rotate(${pose[limb.angle]}deg); }\n`;
                        }
                        css += `    100% { transform: translateX(${poses[0][limb.offset]}px) rotate(${poses[0][limb.angle]}deg); }\n`;
                    } else {
                        // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö: —Ç–æ–ª—å–∫–æ –≤—Ä–∞—â–µ–Ω–∏–µ
                        css += `    0% { transform: rotate(${poses[0][limb.angle]}deg); }\n`;
                        for (let i = 1; i < poses.length - 1; i++) {
                            const percent = (i / (poses.length - 1)) * 100;
                            const pose = poses[i];
                            css += `    ${percent.toFixed(2)}% { transform: rotate(${pose[limb.angle]}deg); }\n`;
                        }
                        css += `    100% { transform: rotate(${poses[0][limb.angle]}deg); }\n`;
                    }
                    css += `}\n\n`;
                });
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–Ω–∏ (—Å–ª–µ–¥—É–µ—Ç –∑–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º –¥–≤–∏–∂–µ–Ω–∏–µ–º –∏ –ø–æ–≤–æ—Ä–æ—Ç–æ–º —Ç–µ–ª–∞)
                css += `@keyframes ${id}-shadow {\n`;
                css += `    0% { 
                    transform: translateY(${-poses[0].verticalOffset * 0.3}px) scaleX(${1 - poses[0].verticalOffset * 0.01}) scaleY(${1 - Math.abs(poses[0].verticalOffset) * 0.02}); 
                    opacity: ${0.3 - Math.abs(poses[0].verticalOffset) * 0.008};
                }\n`;
                for (let i = 1; i < poses.length - 1; i++) {
                    const percent = (i / (poses.length - 1)) * 100;
                    const pose = poses[i];
                    // –¢–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–Ω—å—à–µ –∏ —Å–≤–µ—Ç–ª–µ–µ –∫–æ–≥–¥–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂ –ø—Ä—ã–≥–∞–µ—Ç (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ)
                    css += `    ${percent.toFixed(2)}% { 
                        transform: translateY(${-pose.verticalOffset * 0.3}px) scaleX(${1 - pose.verticalOffset * 0.01}) scaleY(${1 - Math.abs(pose.verticalOffset) * 0.02}); 
                        opacity: ${0.3 - Math.abs(pose.verticalOffset) * 0.008};
                    }\n`;
                }
                css += `    100% { 
                    transform: translateY(${-poses[0].verticalOffset * 0.3}px) scaleX(${1 - poses[0].verticalOffset * 0.01}) scaleY(${1 - Math.abs(poses[0].verticalOffset) * 0.02}); 
                    opacity: ${0.3 - Math.abs(poses[0].verticalOffset) * 0.008};
                }\n`;
                css += `}\n\n`;
                
                return css;
            }
            
            
            // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∞–Ω—Ü–µ
            getDanceInfo() {
                const energy = this.generateEnergy();
                const prefs = this.generateMovePreferences();
                const color = this.generateColor();
                const poses = this.generatePoseSequence();
                const physique = this.generatePhysique();
                
                return {
                    color: `hsl(${color.hue}, ${color.saturation}%, ${color.lightness}%)`,
                    energy: energy,
                    preferences: prefs,
                    physique: physique,
                    poses: poses,
                    moves: poses.map((pose, i) => this.describePose(pose, i))
                };
            }
        }
        
        // UI Functions
        function generateDancer() {
            const ulid = document.getElementById('ulidInput').value.trim();
            if (ulid.length !== 26) {
                alert('ULID –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–æ–≤–Ω–æ 26 —Å–∏–º–≤–æ–ª–æ–≤!');
                return;
            }
            
            const dancer = new SkeletalAnimaID(ulid);
            const info = dancer.getDanceInfo();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–≥–æ —Ç–∞–Ω—Ü–æ—Ä–∞
            document.getElementById('mainDancer').innerHTML = dancer.generateSVG(250);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            const paramsDiv = document.getElementById('params');
            paramsDiv.innerHTML = `
                <div class="param-item">
                    <span class="param-label">ULID:</span>
                    <span class="param-value" style="font-size: 0.8em;">${ulid}</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–¶–≤–µ—Ç:</span>
                    <span class="param-value">
                        <span style="display: inline-block; width: 20px; height: 20px; background: ${info.color}; border-radius: 50%; vertical-align: middle; margin-left: 5px;"></span>
                    </span>
                </div>
                <div class="param-item">
                    <span class="param-label">–¢–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ:</span>
                    <span class="param-value">${(info.physique.build * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–≠–Ω–µ—Ä–≥–∏—è:</span>
                    <span class="param-value">${(info.energy * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–î–≤–∏–∂–µ–Ω–∏—è —Ä—É–∫:</span>
                    <span class="param-value">${(info.preferences.armMovement * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–î–≤–∏–∂–µ–Ω–∏—è –Ω–æ–≥:</span>
                    <span class="param-value">${(info.preferences.legMovement * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–ü—Ä—ã–∂–∫–∏:</span>
                    <span class="param-value">${(info.preferences.jumpiness * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–°–∏–º–º–µ—Ç—Ä–∏—è:</span>
                    <span class="param-value">${(info.preferences.symmetry * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–î–≤–∏–∂–µ–Ω–∏—è –≥–æ–ª–æ–≤—ã:</span>
                    <span class="param-value">${(info.preferences.headMovement * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–ö–∞—á–∞–Ω–∏–µ –±—ë–¥—Ä–∞–º–∏:</span>
                    <span class="param-value">${(info.preferences.hipSway * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–î–≤–∏–∂–µ–Ω–∏—è –ø–ª–µ—á:</span>
                    <span class="param-value">${(info.preferences.shoulderBounce * 100).toFixed(0)}%</span>
                </div>
                <div class="param-item">
                    <span class="param-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞:</span>
                    <span class="param-value">4.0 —Å–µ–∫ (8 –±–∏—Ç)</span>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏–π
            const movesDiv = document.getElementById('movesList');
            movesDiv.innerHTML = info.moves.map(move => 
                `<div class="move-item">${move}</div>`
            ).join('');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä BPM
            startBPMIndicator();
        }
        
        function randomULID() {
            const chars = '0123456789ABCDEFGHJKMNPQRSTVWXYZ';
            let ulid = '';
            for (let i = 0; i < 26; i++) {
                ulid += chars[Math.floor(Math.random() * chars.length)];
            }
            document.getElementById('ulidInput').value = ulid;
            generateDancer();
        }
        
        function generateGallery() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '<h2 style="grid-column: 1/-1; margin-bottom: 10px;">üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è —Ä–∞–∑–Ω—ã—Ö —Ç–∞–Ω—Ü–æ—Ä–æ–≤</h2>';
            
            for (let i = 0; i < 10; i++) {
                const chars = '0123456789ABCDEFGHJKMNPQRSTVWXYZ';
                let ulid = '';
                for (let j = 0; j < 26; j++) {
                    ulid += chars[Math.floor(Math.random() * chars.length)];
                }
                
                const dancer = new SkeletalAnimaID(ulid);
                const item = document.createElement('div');
                item.className = 'gallery-item';
                item.onclick = () => {
                    document.getElementById('ulidInput').value = ulid;
                    generateDancer();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                };
                
                item.innerHTML = `
                    <div class="gallery-avatar">${dancer.generateSVG(100)}</div>
                    <div class="gallery-label">${ulid.substring(0, 8)}...</div>
                `;
                
                gallery.appendChild(item);
            }
        }
        
        let bpmInterval;
        function startBPMIndicator() {
            if (bpmInterval) clearInterval(bpmInterval);
            
            const indicator = document.getElementById('bpmIndicator');
            bpmInterval = setInterval(() => {
                indicator.classList.add('beat-flash');
                setTimeout(() => indicator.classList.remove('beat-flash'), 100);
            }, 500); // 120 BPM = 0.5 sec per beat
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            generateDancer();
        });
    </script>
</body>
</html>
